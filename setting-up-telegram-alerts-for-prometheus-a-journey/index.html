<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://andreyshuster.github.io/images/favicon.png><title>Setting Up Telegram Alerts for Prometheus - A Journey | Less is more</title><meta name=title content="Setting Up Telegram Alerts for Prometheus - A Journey"><meta name=description content="Today I added something useful and long overdue to my homelab.
My Spectrum router does not cover the whole house (it is not in the middle, but in a side room which is my home office), so I purchased an additional WiFi pod from Spectrum to create a mesh network. Unfortunately, the outlet where the pod is plugged in is a bit loose, so sometimes it disconnects and then Netflix starts to misbehave."><meta name=keywords content="homelab,alertmanager,prometheus,devops,"><meta property="og:url" content="https://andreyshuster.github.io/setting-up-telegram-alerts-for-prometheus-a-journey/"><meta property="og:site_name" content="Less is more"><meta property="og:title" content="Setting Up Telegram Alerts for Prometheus - A Journey"><meta property="og:description" content="Today I added something useful and long overdue to my homelab. My Spectrum router does not cover the whole house (it is not in the middle, but in a side room which is my home office), so I purchased an additional WiFi pod from Spectrum to create a mesh network. Unfortunately, the outlet where the pod is plugged in is a bit loose, so sometimes it disconnects and then Netflix starts to misbehave."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2026-01-10T21:59:22-06:00"><meta property="article:modified_time" content="2026-01-10T21:59:22-06:00"><meta property="article:tag" content="Homelab"><meta property="article:tag" content="Alertmanager"><meta property="article:tag" content="Prometheus"><meta property="article:tag" content="Devops"><meta property="og:image" content="https://andreyshuster.github.io/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://andreyshuster.github.io/images/share.png"><meta name=twitter:title content="Setting Up Telegram Alerts for Prometheus - A Journey"><meta name=twitter:description content="Today I added something useful and long overdue to my homelab. My Spectrum router does not cover the whole house (it is not in the middle, but in a side room which is my home office), so I purchased an additional WiFi pod from Spectrum to create a mesh network. Unfortunately, the outlet where the pod is plugged in is a bit loose, so sometimes it disconnects and then Netflix starts to misbehave."><meta itemprop=name content="Setting Up Telegram Alerts for Prometheus - A Journey"><meta itemprop=description content="Today I added something useful and long overdue to my homelab. My Spectrum router does not cover the whole house (it is not in the middle, but in a side room which is my home office), so I purchased an additional WiFi pod from Spectrum to create a mesh network. Unfortunately, the outlet where the pod is plugged in is a bit loose, so sometimes it disconnects and then Netflix starts to misbehave."><meta itemprop=datePublished content="2026-01-10T21:59:22-06:00"><meta itemprop=dateModified content="2026-01-10T21:59:22-06:00"><meta itemprop=wordCount content="710"><meta itemprop=image content="https://andreyshuster.github.io/images/share.png"><meta itemprop=keywords content="Homelab,Alertmanager,Prometheus,Devops"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=/ class=title><h2>Less is more</h2></a><nav><a href=/>Home</a>
<a href=/blog>Blog</a>
<a href=https://x.com/andrey_shuster>Twitter</a>
<a href=https://github.com/andreyshuster>GitHub</a>
<a href=/pages/about>About</a></nav></header><main><h1>Setting Up Telegram Alerts for Prometheus - A Journey</h1><p><i><time datetime=2026-01-10 pubdate>10 Jan, 2026</time></i></p><content><p>Today I added something useful and long overdue to my homelab.
My Spectrum router does not cover the whole house (it is not in the middle, but in a side room which is my home office), so I purchased an additional WiFi pod from Spectrum to create a mesh network. Unfortunately, the outlet where the pod is plugged in is a bit loose, so sometimes it disconnects and then Netflix starts to misbehave.</p><p>I have a small k3s cluster at home, built as an experiment on top of two Raspberry Pis (RP5 and RP Zero W 2) and an old laptop, and I thought it would be a good idea to use the cluster to solve this problem.</p><h2 id=what-we-wanted>What We Wanted</h2><p>I use Telegram a lot, so I decided I wanted to get a Telegram notification when our Spectrum pod (192.168.1.135) goes down.</p><h2 id=plan>Plan</h2><ul><li>Set up Alertmanager</li><li>Add the pod as a target to blackbox-exporter</li><li>Create the alert rule</li><li>Configure the integration with Telegram</li><li>Test it</li></ul><h2 id=the-discovery-phase>The Discovery Phase</h2><p>Did Helm install Alertmanager with Prometheus?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n monitoring | grep alert
</span></span><span style=display:flex><span>prometheus-alertmanager-0    1/1     Running   <span style=color:#ae81ff>0</span>      6d
</span></span></code></pre></div><p>Cool, it is running, but completely useless without proper configuration.</p><h2 id=adding-the-probe-target>Adding the Probe Target</h2><p>We are already using blackbox-exporter to ICMP ping a bunch of hosts (routers, laptops, servers, DNS servers, etc.), so adding our Spectrum pod was easy: just drop it into the targets list.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ae81ff>192.168.1.135</span>    <span style=color:#75715e># Spectrum pod</span>
</span></span></code></pre></div><h2 id=creating-the-alert-rule>Creating the Alert Rule</h2><p>Then we needed an actual alert rule. A simple one that fires when any of our monitored hosts fails the ICMP probe for more than 2 minutes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HostDown</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>probe_success{job=&#34;blackbox&#34;} == 0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>for</span>: <span style=color:#ae81ff>2m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;Spectrum POD {{ $labels.instance }} is down&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;ICMP probe to {{ $labels.instance }} has failed for more than 2 minutes.&#34;</span>
</span></span></code></pre></div><p>Pretty straightforward: if <code>probe_success</code> is 0, something is wrong.</p><h2 id=the-telegram-integration-aka-the-fun-part>The Telegram Integration (aka The Fun Part)</h2><p>Here is where it got interesting. We wanted to send alerts to Telegram, but we had a problem: <strong>how do you configure secrets without committing them to GitHub?</strong></p><p>The solution:</p><ol><li>Add the actual config file to <code>.gitignore</code>.</li><li>Create a Kubernetes Secret with the real Telegram bot token and chat ID.</li><li>Configure Helm to use this Secret.</li></ol><p>Seemed perfect. Except…</p><h2 id=the-plot-twist>The Plot Twist</h2><p>After applying everything with <code>helm upgrade</code>, Alertmanager was still using the default receiver. What gives?</p><p>It turned out the <code>configFromSecret</code> parameter we set in the Helm values was not actually working. The Helm chart kept creating and using a ConfigMap with the default config, completely ignoring our fancy Secret.</p><p>Classic Kubernetes moment.</p><h2 id=the-fix>The Fix</h2><p>Sometimes you have to be pragmatic. Instead of fighting with Helm, we just:</p><ol><li>Pulled the config from our Secret.</li><li>Manually updated the ConfigMap.</li><li>Restarted the Alertmanager pod.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get secret alertmanager-telegram-config -n monitoring -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.data.alertmanager\.yml}&#39;</span> | base64 -d &gt; /tmp/alertmanager-telegram.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl create configmap prometheus-alertmanager --from-file<span style=color:#f92672>=</span>alertmanager.yml<span style=color:#f92672>=</span>/tmp/alertmanager-telegram.yml -n monitoring --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl delete pod prometheus-alertmanager-0 -n monitoring
</span></span></code></pre></div><p>Boom. Then we verified the config:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -s http://localhost:9093/api/v2/status | jq -r <span style=color:#e6db74>&#39;.config.route.receiver&#39;</span>
</span></span><span style=display:flex><span>telegram
</span></span></code></pre></div><h2 id=testing-time>Testing Time</h2><p>We sent a test alert via the Alertmanager API:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST http://localhost:9093/api/v2/alerts -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> -d <span style=color:#e6db74>&#39;[{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;labels&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;alertname&#34;: &#34;HostDown&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;instance&#34;: &#34;192.168.1.135&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;severity&#34;: &#34;critical&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;job&#34;: &#34;blackbox&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;annotations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;summary&#34;: &#34;Spectrum POD 192.168.1.135 is down&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;description&#34;: &#34;ICMP probe to 192.168.1.135 has failed for more than 2 minutes.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}]&#39;</span>
</span></span></code></pre></div><p>And Telegram notification received.</p><h2 id=lessons-learned>Lessons Learned</h2><ol><li><strong>Helm charts do not always work the way you expect</strong> – sometimes you have to work around them.</li><li><strong>ConfigMaps get overwritten by Helm</strong> – this is now documented in the troubleshooting guide.</li><li><strong>Testing with the API is much faster</strong> – do not wait 2 minutes for real alerts to fire.</li><li><strong>Never commit secrets to Git</strong> – even when it seems convenient.</li></ol><h2 id=whats-next>What’s Next?</h2><p>Now that we have the basic setup working, we could:</p><ul><li>Add more alert rules (high CPU, disk space, memory, etc.).</li><li>Set up different notification channels for different severity levels.</li><li>Add some silencing rules for maintenance windows.</li><li>Fine-tune the group intervals and repeat intervals.</li></ul><p>But for now, alerts are going to Telegram, and that is a win.</p><p><em>P.S. Don&rsquo;t forget to run those troubleshooting commands after any <code>helm upgrade</code> because the ConfigMap will get reset.</em></p></content><p><a href=https://andreyshuster.github.io/blog/homelab/>#Homelab</a>
<a href=https://andreyshuster.github.io/blog/alertmanager/>#Alertmanager</a>
<a href=https://andreyshuster.github.io/blog/prometheus/>#Prometheus</a>
<a href=https://andreyshuster.github.io/blog/devops/>#Devops</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>